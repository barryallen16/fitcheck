<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitcheck</title>
  <!-- Favicon & PWA Icons -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">
<link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />


  <style>
    body{
  font-family: "Space Grotesk", sans-serif;
  font-optical-sizing: auto;
  font-style: normal;
    }
    .gender-btn.active {
      background-color: #111827; /* gray-900 */
      color: white;
      transform: scale(1.05);
    }
    .gender-btn {
      transition: all 0.2s ease;
    }
    .gender-btn:hover {
      transform: scale(1.03);
    }
    #outfit-container {
      touch-action: pan-y;
    }
    .slide-from-left {
      animation: slideFromLeft 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .slide-from-right {
      animation: slideFromRight 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .slide-from-bottom {
      animation: slideFromBottom 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    @keyframes slideFromLeft {
      from {
        opacity: 0;
        transform: translateX(-100%) rotate(-5deg);
      }
      to {
        opacity: 1;
        transform: translateX(0) rotate(0deg);
      }
    }
    @keyframes slideFromRight {
      from {
        opacity: 0;
        transform: translateX(100%) rotate(5deg);
      }
      to {
        opacity: 1;
        transform: translateX(0) rotate(0deg);
      }
    }
    @keyframes slideFromBottom {
      from {
        opacity: 0;
        transform: translateY(100%) rotate(0deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
    }
    .approved-glow {
      animation: glow 0.6s ease-in-out;
    }
    @keyframes glow {
      0% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); transform: scale(1); }
      50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); transform: scale(1.05); }
      100% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); transform: scale(1); }
    }
    .rejected-shake {
      animation: shake 0.6s ease-in-out;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }
    #outfit-card {
      will-change: transform;
    }
    #skip-suggestion {
      white-space: nowrap;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-50 via-white to-gray-50 min-h-screen flex flex-col p-4 sm:p-6">

  <!-- Preview Card -->
  <div class="sticky top-8 z-50 flex justify-between items-center bg-black/40 backdrop-blur-md px-2 py-2 rounded-xl shadow-md">
    <a href="https://www.instagram.com/ordinarypeople.team/">
      <img src="op-logo.png" class="w-16 sm:w-20" alt="Brand Logo">
    </a>
    <div id="gender-control" role="radiogroup" aria-label="Gender"
         class="bg-white/50 backdrop-blur-md border border-white/40 px-2 py-1 rounded-full shadow-sm flex items-center gap-1">
      <button id="gender-male" role="radio" aria-checked="false"
              data-gender="male"
              class="gender-btn flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm text-gray-700 focus:outline-none">
        <i class="fa-solid fa-mars text-sm sm:text-base"></i><span>Male</span>
      </button>
      <button id="gender-female" role="radio" aria-checked="false"
              data-gender="female"
              class="gender-btn flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm text-gray-700 focus:outline-none">
        <i class="fa-solid fa-venus text-sm sm:text-base"></i><span>Female</span>
      </button>
    </div>
  </div>
  <div class="w-full max-w-md flex-1 flex flex-col">

<!-- Hero Section - Full Screen -->
<section class="h-screen flex flex-col justify-center items-center text-center relative z-10 px-6 bg-white">
  <div class="mb-6">
    <a href="https://www.instagram.com/ordinarypeople.team/">

    <img src="op-logo.png" class="w-40 sm:w-48 mx-auto drop-shadow-lg" alt="Ordinary People Logo"></a>
  </div>

  <h1 class="text-black text-3xl sm:text-4xl font-bold leading-tight">
    Help Us Build Smarter Style AI
  </h1>

  <p class="text-black/70 text-base sm:text-lg max-w-md mt-3">
    Your quick choices help train our model to make better outfit recommendations.
    <span class="block text-sm text-black/50 mt-1">
      Takes less than 10 seconds â€“ no login needed.
    </span>
  </p>

  <button id="start-btn" disabled
          class="px-8 sm:px-10 py-3 rounded-full bg-black/90 text-white font-medium text-lg hover:bg-black transition-all mt-6 opacity-50 cursor-not-allowed">
    Select Gender to Start <i class="fa-solid fa-arrow-right inline-block ml-2"></i>
  </button>

</section>

<section id="clothes-section" class="scroll-mt-24 relative">
  
  <div class="bg-white rounded-2xl shadow-lg p-3 sm:p-4 flex-1 overflow-auto">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Vote on Random Outfits</h2>
      <div id="vote-counter" class="text-sm font-medium text-gray-600">0 votes</div>
    </div>
    <p class="text-gray-600 text-sm mb-4">Swipe right to approve, left to reject, up to skip</p>
  
    <div id="outfit-container" class="relative overflow-hidden">
      <div id="outfit-card" class="relative bg-white rounded-2xl overflow-hidden max-h-[90vh] shadow-xl border border-gray-100 transition-all duration-[400ms] ease-[cubic-bezier(0.25,0.1,0.25,1)]">
        <!-- Swipe Labels -->
        <div id="add-label" class="absolute -right-24 top-1/2 -translate-y-1/2 z-20 bg-emerald-500 text-white px-6 py-3 rounded-full shadow-lg whitespace-nowrap text-lg font-bold opacity-0 transition-all duration-200 transform translate-x-[100%]">
          <i class="fa-solid fa-plus mr-2"></i>ADD
        </div>
        <div id="nah-label" class="absolute -left-24 top-1/2 -translate-y-1/2 z-20 bg-red-500 text-white px-6 py-3 rounded-full shadow-lg whitespace-nowrap text-lg font-bold opacity-0 transition-all duration-200 transform translate-x-[-100%]">
          <i class="fa-solid fa-xmark mr-2"></i>NAH
        </div>
        <div id="skip-label" class="absolute -top-24 left-1/2 -translate-x-1/2 z-20 bg-yellow-500 text-white px-6 py-3 rounded-full shadow-lg whitespace-nowrap text-lg font-bold opacity-0 transition-all duration-200">
          <i class="fa-solid fa-forward mr-2"></i>SKIP
        </div>
        
        <!-- Feedback Overlay -->
        <div id="swipe-feedback" class="absolute inset-0 flex flex-col items-center justify-center bg-black/50 backdrop-blur-sm text-white text-4xl font-bold opacity-0 transition-all duration-300 pointer-events-none z-10 gap-2">
          <i id="feedback-icon" class="text-5xl"></i>
          <span id="feedback-text"></span>
        </div>
        
        <!-- Skip Suggestion -->
        <div id="skip-suggestion" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-yellow-500/90 backdrop-blur-sm text-black px-6 py-3 rounded-full text-sm font-medium opacity-0 transition-opacity duration-300 pointer-events-none z-30 flex items-center gap-2">
          Can't decide? <i class="fa-solid fa-hand-point-up"></i> Swipe up to skip!
        </div>
        
        <div class="p-3 sm:p-4 relative z-0">
          <!-- Top -->
          <div class="bg-white rounded-xl overflow-hidden mb-4 sm:mb-6 max-h-[40vh] sm:max-h-[250px]">
            <img id="main-top" class="w-full object-contain fade-img opacity-0 max-h-[40vh] sm:max-h-[250px] transition-opacity duration-300" alt="Top Preview" />
          </div>
      
          <!-- Bottom -->
          <div class="bg-white rounded-xl overflow-hidden max-h-[40vh] sm:max-h-[250px]">
            <img id="main-bottom" class="w-full object-contain fade-img opacity-0 max-h-[40vh] sm:max-h-[250px] transition-opacity duration-300" alt="Bottom Preview" />
          </div>
        </div>
      </div>
    </div>

    <!-- Feedback Button Section -->
    <div id="feedback-section" class="hidden mt-6 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl shadow-lg text-white text-center">
      <p class="text-sm mb-3">Thanks for helping train our AI ! Got suggestions?</p>
      <a href="https://ig.me/m/ordinarypeople.team" target="_blank" rel="noopener noreferrer" class="inline-block bg-white text-purple-600 px-6 py-3 rounded-full font-semibold text-sm hover:bg-gray-100 transition-colors flex items-center gap-2 mx-auto">
        <i class="fab fa-instagram"></i>Send Suggestions on Instagram
      </a>
    </div>
  
  </div>
  
</section>
    

  </div>

<script>
    // Smooth scroll to clothes section
  const startBtn = document.getElementById("start-btn");
  startBtn.addEventListener("click", () => {
    document.getElementById("clothes-section").scrollIntoView({ behavior: "smooth" });
  });

  // Gender selection toggle
  const genderButtons = document.querySelectorAll(".gender-btn");
  genderButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      genderButtons.forEach(b => b.setAttribute("aria-checked", "false").classList.remove("active"));
      btn.setAttribute("aria-checked", "true");
      btn.classList.add("active");
      startBtn.disabled = false;
      startBtn.classList.remove("opacity-50", "cursor-not-allowed");
      startBtn.innerHTML = 'Start Contributing <i class="fa-solid fa-arrow-right inline-block ml-2"></i>';
    });
  });

  const supabaseUrl = 'https://dzlhehodyvemnfyfugov.supabase.co';
  const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6bGhlaG9keXZlbW5meWZ1Z292Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0MTI3MjcsImV4cCI6MjA1Nzk4ODcyN30.lMUnXxA3Xn2vL5ezRHz49uy--A-sQLHKS-gV4yXfbuY';
  const { createClient } = window.supabase;
const supabase = createClient(supabaseUrl, supabaseAnonKey);

const men = {
  top: { 
    "black shirt": "men-shirts/black.jpg", 
    "brown shirt": "men-shirts/brown.jpg", 
    "white shirt": "men-shirts/white.jpg",
    "green shirt": "men-shirts/green.jpg", 
    "grey shirt": "men-shirts/grey.jpg", 
    "light blue shirt": "men-shirts/light-blue.jpg", 
    "maroon shirt": "men-shirts/maroon.jpg",
    "mustard shirt": "men-shirts/mustard.jpg", 
    "navy blue shirt": "men-shirts/navy-blue.jpg", 
    "pink shirt": "men-shirts/pink.jpg",
    "black sherwani": "men-tops/black-sherwani.jpg",
    "grey nehru jacket": "men-tops/grey-nehru-jacket.jpg",
    "maroon kurta": "men-tops/maroon-kurta.jpg",
    "mustard kurta": "men-tops/mustard-kurta.jpg",
    "navy blue kurta": "men-tops/navy-blue-kurta.jpg",
    "olive green kurta": "men-tops/olive-green-kurta.jpg",
    "white kurta": "men-tops/white-kurta.jpg"
  },
  bottom: { 
    "black jean": "men-jeans/black.jpg", 
    "dark blue jean": "men-jeans/dark-blue.jpg",
    "light blue jean": "men-jeans/light-blue.jpg",
    "black pajama": "men-bottoms/black-pajama.jpg",
    "navy blue churidar": "men-bottoms/navy-blue-churidar.jpg",
    "white pajama": "men-bottoms/white-pajama.jpg"
  }
};

const women = {
  top: {
    "black kurti": "women-kurthi/black.jpg", 
    "light blue kurti": "women-kurthi/light-blue.jpg",
    "navy blue kurti": "women-kurthi/navy-blue.jpg", 
    "olive green kurti": "women-kurthi/olive-green.jpg",
    "pink kurti": "women-kurthi/pink.jpg", 
    "purple kurti": "women-kurthi/purple.jpg", 
    "white kurti": "women-kurthi/white.jpg",
    "maroon embroidered kurti": "women-tops/maroon-embroidered-kurt.jpg",
    "pink peplum kurti": "women-tops/pink-peplum-kurti.jpg",
    "purple anarkali": "women-tops/purple-anarkali.jpg",
    "red anarkali": "women-tops/red-anarkali.jpg"
  },
  bottom: { 
    "black jean": "women-jeans/black.jpg", 
    "light blue jean": "women-jeans/light-blue.jpg", 
    "dark blue jean": "women-jeans/dark-blue.jpg",
    "black salwar": "women-bottoms/black-salwar.jpg",
    "light blue churidar": "women-bottoms/light-blue-churidar.jpg",
    "navy blue sharara": "women-bottoms/navy-blue-sharara.jpg",
    "pink palazzo": "women-bottoms/pink-palazzo.jpg",
    "white lehenga skirt": "women-bottoms/white-lehenga-skirt.jpg"
  }
};

if (window.history.replaceState) {
  window.history.replaceState(null, document.title, window.location.href);
}

let currentGender = localStorage.getItem("selectedGender");
let voteCount = parseInt(localStorage.getItem("voteCount") || "0");
const voteCounter = document.getElementById("vote-counter");
let lastSwipeDirection = 'right'; // default for first load
let inactivityTimer;

  const topImg = document.getElementById("main-top");
  const botImg = document.getElementById("main-bottom");
  const genderMaleBtn = document.getElementById("gender-male");
  const genderFemaleBtn = document.getElementById("gender-female");
  const outfitCard = document.getElementById("outfit-card");
  const swipeFeedback = document.getElementById("swipe-feedback");
  const feedbackIcon = document.getElementById("feedback-icon");
  const feedbackText = document.getElementById("feedback-text");
  const addLabel = document.getElementById("add-label");
  const nahLabel = document.getElementById("nah-label");
  const skipLabel = document.getElementById("skip-label");
  const skipSuggestion = document.getElementById("skip-suggestion");

  let currentOutfits = null;
  let currentIndex = 0;

  function dataset() { 
    if (!currentGender) return women; // fallback to women if not set
    return currentGender === "male" ? men : women; 
  }

  function preloadAllImages() {
    // Preload all men images
    Object.values(men.top).forEach(src => { const img = new Image(); img.src = src; });
    Object.values(men.bottom).forEach(src => { const img = new Image(); img.src = src; });
    // Preload all women images
    Object.values(women.top).forEach(src => { const img = new Image(); img.src = src; });
    Object.values(women.bottom).forEach(src => { const img = new Image(); img.src = src; });
  }

  function generateShuffledOutfits(gender) {
    const ds = gender === "male" ? men : women;
    const topKeys = Object.keys(ds.top);
    const bottomKeys = Object.keys(ds.bottom);
    const outfits = [];
    for (let t of topKeys) {
      for (let b of bottomKeys) {
        outfits.push({ top: t, bottom: b });
      }
    }
    // Fisher-Yates shuffle
    for (let i = outfits.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [outfits[i], outfits[j]] = [outfits[j], outfits[i]];
    }
    return outfits;
  }

  function preloadOutfit(outfit, ds) {
    const tempTop = new Image();
    tempTop.src = ds.top[outfit.top];
    const tempBot = new Image();
    tempBot.src = ds.bottom[outfit.bottom];
    return Promise.all([new Promise(r => tempTop.onload = r), new Promise(r => tempBot.onload = r)]);
  }

  function loadOutfit(outfit, ds) {
    return Promise.all([
      new Promise((resolve) => {
        topImg.style.opacity = '0';
        topImg.onload = () => {
          topImg.style.opacity = '1';
          resolve();
        };
        topImg.src = ds.top[outfit.top];
      }),
      new Promise((resolve) => {
        botImg.style.opacity = '0';
        botImg.onload = () => {
          botImg.style.opacity = '1';
          resolve();
        };
        botImg.src = ds.bottom[outfit.bottom];
      })
    ]);
  }

  function updateGenderUI() {
    if (!currentGender) return;
    genderMaleBtn.classList.toggle("active", currentGender === "male");
    genderFemaleBtn.classList.toggle("active", currentGender === "female");
    genderMaleBtn.setAttribute("aria-checked", currentGender === "male");
    genderFemaleBtn.setAttribute("aria-checked", currentGender === "female");
    localStorage.setItem("selectedGender", currentGender);
  }

  function updatePreview() {
    if (!currentGender) {
      currentGender = "female";
      updateGenderUI();
      startBtn.disabled = false;
      startBtn.classList.remove("opacity-50", "cursor-not-allowed");
      startBtn.innerHTML = 'Start Contributing <i class="fa-solid fa-arrow-right inline-block ml-2"></i>';
    }
    updateGenderUI();
    if (!currentOutfits || currentIndex >= currentOutfits.length) {
      currentOutfits = generateShuffledOutfits(currentGender);
      currentIndex = 0;
    }
    const nextOutfit = currentOutfits[currentIndex];
    const ds = dataset();
    preloadOutfit(nextOutfit, ds).catch(console.log);
    outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
    addLabel.classList.add('opacity-0');
    nahLabel.classList.add('opacity-0');
    skipLabel.classList.add('opacity-0');
    swipeFeedback.classList.remove('opacity-100');
    outfitCard.classList.remove('slide-from-left', 'slide-from-right', 'slide-from-bottom', 'approved-glow', 'rejected-shake');
    skipSuggestion.classList.add('opacity-0');
    clearTimeout(inactivityTimer);
    outfitCard.style.opacity = '0';
    loadOutfit(nextOutfit, ds).then(() => {
      outfitCard.style.opacity = '1';
      if (lastSwipeDirection === 'right') {
        outfitCard.classList.add('slide-from-left');
      } else if (lastSwipeDirection === 'left') {
        outfitCard.classList.add('slide-from-right');
      } else if (lastSwipeDirection === 'up') {
        outfitCard.classList.add('slide-from-bottom');
      } else {
        outfitCard.classList.add('slide-from-left');
      }
      inactivityTimer = setTimeout(() => {
        skipSuggestion.classList.remove('opacity-0');
      }, 5000);
    });
  }

  async function voteOutfit(status) {
    const outfit = currentOutfits[currentIndex];
    const payload = {
      gender: currentGender,
      top: outfit.top,
      bottom: outfit.bottom,
      status: status
    };

    try {
      const { data, error } = await supabase
        .from('outfits')
        .insert([payload]);

      if (error) throw error;

      console.log('Supabase response:', data);
      voteCount++;
      voteCounter.textContent = `${voteCount} votes`;
      localStorage.setItem("voteCount", voteCount.toString());
      if (voteCount >= 16) {
        document.getElementById('feedback-section').classList.remove('hidden');
      }
      return true;
    } catch (err) {
      console.error('Error submitting outfit:', err);
      return false;
    }
  }

  function showFeedback(status) {
    let iconClass, color, text, animationClass;
    switch(status) {
      case 'approved':
        iconClass = 'fa-solid fa-plus';
        color = '#10b981';
        text = 'ADD!';
        animationClass = 'approved-glow';
        break;
      case 'rejected':
        iconClass = 'fa-solid fa-xmark';
        color = '#ef4444';
        text = 'NAH!';
        animationClass = 'rejected-shake';
        break;
      case 'skipped':
        iconClass = 'fa-solid fa-forward';
        color = '#f59e0b';
        text = 'SKIP!';
        animationClass = '';
        break;
    }
    feedbackIcon.className = iconClass + ' text-5xl';
    feedbackIcon.style.color = color;
    feedbackText.textContent = text;
    swipeFeedback.classList.add('opacity-100');
    if (animationClass) {
      outfitCard.classList.add(animationClass);
      setTimeout(() => {
        outfitCard.classList.remove(animationClass);
      }, 600);
    }
    if (status === 'approved') {
      if ('vibrate' in navigator) {
        navigator.vibrate([50, 100, 50]);
      }
    } else if (status === 'rejected') {
      if ('vibrate' in navigator) {
        navigator.vibrate([100]);
      }
    }
  }

  function updateHorizontalLabels(deltaX) {
    if (deltaX > 60) {
      addLabel.classList.remove('opacity-0');
      nahLabel.classList.add('opacity-0');
    } else if (deltaX < -60) {
      nahLabel.classList.remove('opacity-0');
      addLabel.classList.add('opacity-0');
    } else {
      addLabel.classList.add('opacity-0');
      nahLabel.classList.add('opacity-0');
    }
  }

  // Swipe functionality for touch
  let startX = 0;
  let startY = 0;
  let currentX = 0;
  let currentY = 0;
  let isDragging = false;

  outfitCard.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
    currentX = startX;
    currentY = startY;
    isDragging = true;
    outfitCard.style.transition = 'none';
    skipSuggestion.classList.add('opacity-0');
    clearTimeout(inactivityTimer);
  }, { passive: true });

  outfitCard.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    currentX = e.touches[0].clientX;
    currentY = e.touches[0].clientY;
    const deltaX = currentX - startX;
    const deltaY = currentY - startY;
    const absDeltaX = Math.abs(deltaX);
    const absDeltaY = Math.abs(deltaY);
    if (absDeltaX > absDeltaY && absDeltaX > 15) {
      // Horizontal dominant
      e.preventDefault();
      const rotate = deltaX / 15;
      outfitCard.style.transform = `translateX(${deltaX}px) translateY(0) rotate(${rotate}deg)`;
      updateHorizontalLabels(deltaX);
      skipLabel.classList.add('opacity-0');
    } else if (absDeltaY > absDeltaX && deltaY < 0 && absDeltaY > 15) {
      // Vertical up dominant
      e.preventDefault();
      const rotate = deltaY / 20;
      outfitCard.style.transform = `translateX(0) translateY(${deltaY}px) rotate(${rotate}deg)`;
      if (deltaY < -60) {
        skipLabel.classList.remove('opacity-0');
      } else {
        skipLabel.classList.add('opacity-0');
      }
      updateHorizontalLabels(0);
    } else {
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
    }
  }, { passive: false });

  outfitCard.addEventListener('touchend', async (e) => {
    if (!isDragging) return;
    isDragging = false;
    const deltaX = currentX - startX;
    const deltaY = currentY - startY;
    const absDeltaX = Math.abs(deltaX);
    const absDeltaY = Math.abs(deltaY);
    const threshold = 120;
    outfitCard.style.transition = 'all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
    if (absDeltaX > absDeltaY && absDeltaX > threshold) {
      // Horizontal swipe
      const status = deltaX > 0 ? 'approved' : 'rejected';
      lastSwipeDirection = deltaX > 0 ? 'right' : 'left';
      const flyOut = (deltaX > 0 ? 1.5 : -1.5) * window.innerWidth;
      outfitCard.style.transform = `translateX(${flyOut}px) translateY(0) rotate(${deltaX / 8}deg) scale(0.9)`;
      showFeedback(status);
      const success = await voteOutfit(status);
      setTimeout(() => {
        if (success) {
          currentIndex++;
          updatePreview();
        } else {
          // Reset
          outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
          feedbackText.textContent = 'ERROR!';
          setTimeout(() => {
            swipeFeedback.classList.remove('opacity-100');
          }, 1500);
        }
      }, 400);
    } else if (absDeltaY > absDeltaX && deltaY < -threshold) {
      // Vertical up swipe (skip)
      lastSwipeDirection = 'up';
      const flyOut = -1.5 * window.innerHeight;
      outfitCard.style.transform = `translateX(0) translateY(${flyOut}px) rotate(${deltaY / 8}deg) scale(0.9)`;
      showFeedback('skipped');
      setTimeout(() => {
        currentIndex++;
        updatePreview();
      }, 400);
    } else {
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
      updateHorizontalLabels(0);
      skipLabel.classList.add('opacity-0');
    }
  }, { passive: true });

  // Mouse support
  outfitCard.addEventListener('mousedown', (e) => {
    startX = e.clientX;
    startY = e.clientY;
    currentX = startX;
    currentY = startY;
    isDragging = true;
    outfitCard.style.transition = 'none';
    skipSuggestion.classList.add('opacity-0');
    clearTimeout(inactivityTimer);
    e.preventDefault();
  });

  outfitCard.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    currentX = e.clientX;
    currentY = e.clientY;
    const deltaX = currentX - startX;
    const deltaY = currentY - startY;
    const absDeltaX = Math.abs(deltaX);
    const absDeltaY = Math.abs(deltaY);
    if (absDeltaX > absDeltaY && absDeltaX > 15) {
      // Horizontal dominant
      const rotate = deltaX / 15;
      outfitCard.style.transform = `translateX(${deltaX}px) translateY(0) rotate(${rotate}deg)`;
      updateHorizontalLabels(deltaX);
      skipLabel.classList.add('opacity-0');
    } else if (absDeltaY > absDeltaX && deltaY < 0 && absDeltaY > 15) {
      // Vertical up dominant
      const rotate = deltaY / 20;
      outfitCard.style.transform = `translateX(0) translateY(${deltaY}px) rotate(${rotate}deg)`;
      if (deltaY < -60) {
        skipLabel.classList.remove('opacity-0');
      } else {
        skipLabel.classList.add('opacity-0');
      }
      updateHorizontalLabels(0);
    } else {
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
    }
  });

  outfitCard.addEventListener('mouseup', async (e) => {
    if (!isDragging) return;
    isDragging = false;
    const deltaX = currentX - startX;
    const deltaY = currentY - startY;
    const absDeltaX = Math.abs(deltaX);
    const absDeltaY = Math.abs(deltaY);
    const threshold = 120;
    outfitCard.style.transition = 'all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
    if (absDeltaX > absDeltaY && absDeltaX > threshold) {
      // Horizontal swipe
      const status = deltaX > 0 ? 'approved' : 'rejected';
      lastSwipeDirection = deltaX > 0 ? 'right' : 'left';
      const flyOut = (deltaX > 0 ? 1.5 : -1.5) * window.innerWidth;
      outfitCard.style.transform = `translateX(${flyOut}px) translateY(0) rotate(${deltaX / 8}deg) scale(0.9)`;
      showFeedback(status);
      const success = await voteOutfit(status);
      setTimeout(() => {
        if (success) {
          currentIndex++;
          updatePreview();
        } else {
          outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
          feedbackText.textContent = 'ERROR!';
          setTimeout(() => {
            swipeFeedback.classList.remove('opacity-100');
          }, 1500);
        }
      }, 400);
    } else if (absDeltaY > absDeltaX && deltaY < -threshold) {
      // Vertical up swipe (skip)
      lastSwipeDirection = 'up';
      const flyOut = -1.5 * window.innerHeight;
      outfitCard.style.transform = `translateX(0) translateY(${flyOut}px) rotate(${deltaY / 8}deg) scale(0.9)`;
      showFeedback('skipped');
      setTimeout(() => {
        currentIndex++;
        updatePreview();
      }, 400);
    } else {
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
      updateHorizontalLabels(0);
      skipLabel.classList.add('opacity-0');
    }
  });

  // Reset on leave
  document.addEventListener('touchend', () => {
    if (isDragging) {
      isDragging = false;
      outfitCard.style.transition = 'all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
      updateHorizontalLabels(0);
      skipLabel.classList.add('opacity-0');
    }
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      outfitCard.style.transition = 'all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
      outfitCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
      updateHorizontalLabels(0);
      skipLabel.classList.add('opacity-0');
    }
  });

  genderMaleBtn.addEventListener("click", () => { 
    currentGender = "male"; 
    currentOutfits = null;
    updatePreview(); 
  });
  genderFemaleBtn.addEventListener("click", () => { 
    currentGender = "female"; 
    currentOutfits = null;
    updatePreview(); 
  });

  document.addEventListener("DOMContentLoaded", () => {
    preloadAllImages();
    voteCounter.textContent = `${voteCount} votes`;
    if (voteCount >= 16) {
      document.getElementById('feedback-section').classList.remove('hidden');
    }
    if (currentGender) {
      currentGender = currentGender.toLowerCase();
      updateGenderUI();
      startBtn.disabled = false;
      startBtn.classList.remove("opacity-50", "cursor-not-allowed");
      startBtn.innerHTML = 'Start Contributing <i class="fa-solid fa-arrow-right inline-block ml-2"></i>';
      updatePreview();
    }
  });
</script>
    
</body>
</html>